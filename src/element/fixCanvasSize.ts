import {
  convertToExcalidrawElements,
  ExcalidrawElementSkeleton,
} from "../data/transform";
import { AppState, ExcalidrawImperativeAPI } from "../types";
import { ExcalidrawElement } from "./types";

const base64BackgroundImage =
  "data:image/png;base64,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";

const frameElement = {
  type: "frame",
  id: "CtfrFGQ6SOW14GOkSqQFq",
  x: 0,
  y: 0,
  width: 0,
  height: 0,
  locked: true,
};

const backgroundElement = {
  type: "image",
  id: "moDgKT4MmX_QRzzgTlcVC",
  x: 0,
  y: 0,
  width: 0,
  height: 0,
  frameId: "CtfrFGQ6SOW14GOkSqQFq",
  locked: true,
  fileId: "b12919d6-f7a7-c543-cd6d-585552719f67",
  scale: [1, 1],
};

const noteSnapshot = {
  elements: [] as ExcalidrawElement[],
  appState: {} as Readonly<AppState>,
  files: {
    "b12919d6-f7a7-c543-cd6d-585552719f67": {
      mimeType: "image/jpeg",
      id: "b12919d6-f7a7-c543-cd6d-585552719f67",
      dataURL: base64BackgroundImage,
    },
  },
};

export const fixCanvasSize = (
  localDataState: any,
  excalidrawAPI: ExcalidrawImperativeAPI,
) => {
  const appState = excalidrawAPI.getAppState();

  if (
    localDataState.elements?.length > 0 ||
    appState.canvasSize.mode !== "fixed"
  ) {
    return localDataState;
  }

  noteSnapshot.appState = appState;

  const canvasWidth = appState.canvasSize.width;
  const canvasHeight = appState.canvasSize.height;

  frameElement.height = canvasHeight;
  frameElement.width = canvasWidth;

  backgroundElement.height = canvasHeight;
  backgroundElement.width = canvasWidth;

  const elements = [];
  elements.push(backgroundElement);
  elements.push(frameElement);

  noteSnapshot.elements = convertToExcalidrawElements(
    elements as ExcalidrawElementSkeleton[],
  );

  return noteSnapshot;
};
